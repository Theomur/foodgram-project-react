# name: Django-app workflow

# on: [push]

# jobs:
#   build_and_push_to_docker_hub:
#       name: Push Docker image to Docker Hub
#       runs-on: ubuntu-latest
#       steps:
#         - name: Check out the repo
#           uses: actions/checkout@v2 
#         - name: Set up Docker Buildx
#           uses: docker/setup-buildx-action@v1 
#         - name: Login to Docker
#           uses: docker/login-action@v1 
#           with:
#             username: ${{ secrets.DOCKER_USERNAME }} 
#             password: ${{ secrets.DOCKER_PASSWORD }}
#         - name: Push to Docker Hub
#           uses: docker/build-push-action@v2 
#           with:
#             context: backend
#             push: true
#             tags: ${{ secrets.DOCKER_USERNAME }}/foodgram_backend:latest
  
#   deploy:
#     runs-on: ubuntu-latest
#     needs: build_and_push_to_docker_hub
#     steps:
#       - name: executing remote ssh commands to deploy
#         uses: appleboy/ssh-action@master
#         with:
#           host: ${{ secrets.HOST }}
#           username: ${{ secrets.USER }}
#           key: ${{ secrets.SSH_KEY }}
#           passphrase: ${{ secrets.PASSPHRASE }}
#           script: |
#             cd kittygram
#             sudo docker compose -f docker-compose.production.yml pull
#             sudo docker compose -f docker-compose.production.yml down
#             sudo docker compose -f docker-compose.production.yml up -d
#             sudo docker compose -f docker-compose.production.yml exec backend python manage.py migrate
#             sudo docker compose -f docker-compose.production.yml exec backend python manage.py collectstatic --no-input

#   send_message:
#     runs-on: ubuntu-latest
#     needs: deploy
#     steps:
#     - name: Send message
#       uses: appleboy/telegram-action@master
#       with:
#         to: ${{ secrets.TELEGRAM_TO }}
#         token: ${{ secrets.TELEGRAM_TOKEN }}
#         message: "Алярма - ${{ github.actor}} сделал пуш к диплому! \nСообщение коммита - ${{ github.event.commits[0].message }} \nСсылка на коммит - https://github.com/${{ github.repository }}/commit/${{ github.sha }}"